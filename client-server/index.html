



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation for SAFE">
      
      
        <link rel="canonical" href="http://safe-stack.github.io/docs/client-server/">
      
      
        <meta name="author" content="SAFE Stack">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.3, mkdocs-material-2.7.2">
    
    
      
        <title>Client Server communication - SAFE Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.8d40d89b.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.6079476c.css">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="orange" data-md-color-accent="blue">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <a href="#sharing-types" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="http://safe-stack.github.io/docs/" title="SAFE Documentation" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                SAFE Documentation
              </span>
              <span class="md-header-nav__topic">
                Client Server communication
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/SAFE-Stack/docs/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      SAFE-Stack/docs
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    SAFE Documentation
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/SAFE-Stack/docs/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      SAFE-Stack/docs
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../intro/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../overview/" title="SAFE Stack Overview" class="md-nav__link">
      SAFE Stack Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../quickstart/" title="Quick Start" class="md-nav__link">
      Quick Start
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Learn about SAFE
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Learn about SAFE
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Client Server communication
      </label>
    
    <a href="./" title="Client Server communication" class="md-nav__link md-nav__link--active">
      Client Server communication
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sharing-types" title="Sharing Types" class="md-nav__link">
    Sharing Types
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sharing-code" title="Sharing Code" class="md-nav__link">
    Sharing Code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sharing-data" title="Sharing Data" class="md-nav__link">
    Sharing Data
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sharing-using-raw-http" title="Sharing using raw HTTP" class="md-nav__link">
    Sharing using raw HTTP
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#turning-on-fables-json-converter" title="Turning on Fable's JSON Converter" class="md-nav__link">
    Turning on Fable's JSON Converter
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sharing-data-using-fableremoting" title="Sharing data using Fable.Remoting" class="md-nav__link">
    Sharing data using Fable.Remoting
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#when-should-i-use-raw-http-vs-fable-remoting" title="When should I use raw HTTP vs Fable Remoting?" class="md-nav__link">
    When should I use raw HTTP vs Fable Remoting?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../learning/" title="Learning Resources" class="md-nav__link">
      Learning Resources
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../support/" title="Support" class="md-nav__link">
      Support
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../testimonials/" title="Testimonials" class="md-nav__link">
      Testimonials
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sharing-types" title="Sharing Types" class="md-nav__link">
    Sharing Types
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sharing-code" title="Sharing Code" class="md-nav__link">
    Sharing Code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sharing-data" title="Sharing Data" class="md-nav__link">
    Sharing Data
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sharing-using-raw-http" title="Sharing using raw HTTP" class="md-nav__link">
    Sharing using raw HTTP
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#turning-on-fables-json-converter" title="Turning on Fable's JSON Converter" class="md-nav__link">
    Turning on Fable's JSON Converter
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sharing-data-using-fableremoting" title="Sharing data using Fable.Remoting" class="md-nav__link">
    Sharing data using Fable.Remoting
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#when-should-i-use-raw-http-vs-fable-remoting" title="When should I use raw HTTP vs Fable Remoting?" class="md-nav__link">
    When should I use raw HTTP vs Fable Remoting?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/SAFE-Stack/docs/edit/master/docs/client-server.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Client Server communication</h1>
                
                <p>One of SAFE's best features is the ability to share <strong>data</strong>, <strong>types</strong> and <strong>code</strong> across client and server. This page illustrates the different ways this can be achieved.</p>
<h2 id="sharing-types">Sharing Types</h2>
<p>Sharing your domain types and contracts between client and server is extremely simple. Thanks to Fable's excellent F# transpilation into Javascript, you can use all standard F# language features such as Records, Tuples and Discriminated Unions without worry. To share types across both your client and server project, first create a file in your repository called e.g <code>Shared.fs</code>.
<img alt="" src="../img\client-server-01.png" /></p>
<p>Then, create types in the file as needed e.g</p>
<pre><code class="fsharp">type Customer = { Name : string }
</code></pre>

<p>Reference this file to your server project. You can now reference those types in the server.</p>
<pre><code class="xml">&lt;Project Sdk=&quot;Microsoft.NET.Sdk&quot;&gt;
    ...
    &lt;ItemGroup&gt;
        &lt;Compile Include=&quot;../Shared/Shared.fs&quot; /&gt;
    &lt;/ItemGroup&gt;
    ...
&lt;/Project&gt;
</code></pre>

<p>Finally, reference this file to your client project (as above). You can now reference those types in the client; types will be compiled into Javascript types and seamlessly translated for you.</p>
<h2 id="sharing-code">Sharing Code</h2>
<p>You can also share code using the same mechanism. This is extremely useful for e.g shared validation or business logic that needs to occur on both client and server.</p>
<p>Fable will translate your functions into native Javascript, and will even translate many calls to the .NET BCL into javascript! You can read more about this <a href="http://fable.io/docs/compatibility.html">on the Fable website</a>.</p>
<h2 id="sharing-data">Sharing Data</h2>
<p>Sharing data can be achieved in two main ways in SAFE: through <strong>raw HTTP methods</strong>, such as GET and POST etc., or via the <strong>Fable.Remoting</strong> package.</p>
<h3 id="sharing-using-raw-http">Sharing using raw HTTP</h3>
<p>Sharing data using raw HTTP methods is very simple. Start by creating a function in your server that returns some data:</p>
<pre><code class="fsharp">let loadCustomersFromDb() =
    [ { Name = &quot;Joe Bloggs&quot; } ]
</code></pre>

<p>Next, create a method which returns the data as JSON within Giraffe's HTTP context.</p>
<pre><code class="fsharp">/// Returns the results of loadCustomersFromDb as JSON.
let getCustomers next ctx =
    json (loadCustomersFromDb()) next ctx
</code></pre>

<p>You can opt to combine both of the above functions into one, depending on your preferences, but it's often good practice to separate your data access from serving data in HTTP endpoints.</p>
<p>Also note the <code>next</code> and <code>ctx</code> arguments. These are used by Giraffe as part of its HTTP pipeline and are required by the <code>json</code> function.</p>
<p>Now expose the api method using Saturn's <code>scope</code> construct and add the scope to your overall application scope:</p>
<pre><code class="fsharp">let myApis = scope {
    get &quot;api/customers/&quot; getCustomers
}
</code></pre>

<p>For simple endpoints you may elect to embed the API call directly in the scope (and use partial application to omit the <code>next</code> and <code>ctx</code> arguments):</p>
<pre><code class="fsharp">let myApis = scope {
    get &quot;/customers/&quot; (json (loadCustomersFromDb()))
}
</code></pre>

<p>Finally, call the endpoint from your client application.</p>
<pre><code class="fsharp">promise {    
    let! customers = Fetch.fetchAs&lt;Customer array&gt; (sprintf &quot;api/customers&quot;) []
    // do more with customers here...
}
</code></pre>

<p>Note the use of the <code>promise { }</code> computation expression. This functions like <code>async { }</code> blocks that you already know, whilst the <code>fetchAs</code> function automatically deserializes the JSON back into a <code>Customer</code> array.</p>
<h4 id="turning-on-fables-json-converter">Turning on Fable's JSON Converter</h4>
<p>By default, serialization between Fable and Giraffe <strong>is not compatible</strong>. In order to fix this, you must replace the JSON converter in Giraffe with Fable's own <code>IJsonSerializer</code>.</p>
<p>If you are using the dotnet SAFE Template, this will automatically be done for you - see the <code>config</code> function in <code>Server.fs</code>.</p>
<h3 id="sharing-data-using-fableremoting">Sharing data using Fable.Remoting</h3>
<h3 id="when-should-i-use-raw-http-vs-fable-remoting">When should I use raw HTTP vs Fable Remoting?</h3>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        

<!-- Application footer -->
<footer class="md-footer">

  <!-- Link to previous and/or next page -->
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">

        <!-- Link to previous page -->
        
          <a href="../quickstart/"
              title="Quick Start"
              class="md-flex md-footer-nav__link md-footer-nav__link--prev"
              rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back
                    md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch
                  md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Quick Start
              </span>
            </div>
          </a>
        

        <!-- Link to next page -->
        
          <a href="../learning/" title="Learning Resources"
              class="md-flex md-footer-nav__link md-footer-nav__link--next"
              rel="next">
            <div class="md-flex__cell md-flex__cell--stretch
                  md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Learning Resources
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward
                    md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  

  <!-- Further information -->
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">

      <!-- Copyright and theme information -->
      <div class="md-footer-copyright">
        Powered by <a href="http://www.mkdocs.org">MkDocs</a>
        | Supported by
        <a href="http://lambdafactory.io">
            λFactory</a>
        and
        <a href="https://compositional-it.com/">
          Compositional IT</a>
      </div>

      <!-- Social links -->
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://github.com/SAFE-Stack" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/safe_stack" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://safe-stack.github.io/" class="md-footer-social__link fa fa-globe"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.b438e6c5.js"></script>
      
      <script>app.initialize({version:"0.17.3",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>